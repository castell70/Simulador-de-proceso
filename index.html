<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulador de Procesos</title>
  <link rel="stylesheet" href="style.css">
  <script type="importmap">
  {
    "imports": {
      "chart.js": "https://esm.sh/chart.js@4.4.0",
      "chart.js/auto": "https://esm.sh/chart.js@4.4.0/auto",
      "jspdf": "https://esm.sh/jspdf@2.5.1"
    }
  }
  </script>
</head>
<body>
  <div class="topbar">
    <div class="title">Simulador de Procesos</div>
    <div class="powered">Powered by ITCPO</div>
  </div>

  <!-- Added action buttons below topbar -->
  <div class="top-actions">
    <button id="load-sample" class="small-btn action-btn orange">Cargar ejemplo</button>
    <button id="reset-templates" class="small-btn action-btn coral">Reiniciar</button>
    <button id="export-pdf" class="small-btn action-btn teal-dark">Informe PDF</button>
    <button id="export-word" class="small-btn action-btn teal">Respaldar JSON</button>
    <button id="load-backup" class="small-btn action-btn coral">Cargar respaldo</button>
  </div>

  <main id="app">
    <section class="left">
      <h2>Plantillas / Entradas</h2>

      <div class="card">
        <h3>1) A√±adir Proceso</h3>
        <label>Editar proceso
          <select id="proc-select">
            <option value="">-- Nuevo proceso --</option>
          </select>
        </label>
        <label>Nombre del proceso<input id="proc-name" placeholder="Ej: Recepci√≥n"></label>
        <label>Personas asignadas<input id="proc-people" type="number" min="1" value="1"></label>
        <label>Meta calidad (0-100)<input id="proc-quality-target" type="number" min="0" max="100" value="90"></label>
        <div style="display:flex;gap:8px">
          <button id="add-process">Agregar Proceso</button>
          <button id="update-process" style="background:#264653">Modificar Proceso</button>
        </div>
      </div>

      <div class="card">
        <h3>2) A√±adir Tarea</h3>
        <label>Proceso
          <select id="task-process"></select>
        </label>
        <label>Nombre tarea<input id="task-name" placeholder="Ej: Verificar pedido"></label>
        <label>Dificultad (1-10)<input id="task-diff" type="number" min="1" max="10" value="3"></label>
        <label>Costo por tarea (USD)<input id="task-cost" type="number" min="0" step="0.01" value="5"></label>
        <label>Cantidad tareas<input id="task-qty" type="number" min="1" value="10"></label>

        <!-- new: two-button row: Agregar Tarea + Administrar Tareas -->
        <div class="two-btns">
          <button id="add-task">Agregar Tarea</button>
          <button id="manage-tasks" class="small-action">Administrar Tareas</button>
        </div>
      </div>

      <div class="card">
        <h3>3) Ajustar asignaci√≥n por persona</h3>
        <p class="muted">Selecciona proceso y distribuye tareas entre personas (suma debe ser ‚â§ total tareas)</p>
        <label>Proceso
          <select id="assign-process"></select>
        </label>
        <div id="assign-persons"></div>
        <button id="save-assign">Guardar Asignaci√≥n</button>
      </div>

      <div class="card small">
        <button id="run-sim">Ejecutar Simulaci√≥n</button>
        <button id="reset">Restablecer</button>
      </div>

      <div class="card">
        <h3>Registro r√°pido</h3>
        <p class="muted">Vista de registro por proceso (tareas, dificultad, asignadas, costo)</p>
        <div id="records"></div>
      </div>
    </section>

    <section class="right">
      <header>
        <h1>Tablero de Simulaci√≥n</h1>
        <div class="summary">
          <div>Total tareas: <span id="sum-tasks">0</span></div>
          <div>Costo total: $<span id="sum-cost">0.00</span></div>
        </div>
      </header>

      <div class="grid">
        <div class="panel">
          <h4>Tareas por Proceso</h4>
          <canvas id="chart-tasks"></canvas>
        </div>

        <div class="panel">
          <h4>Eficiencia por Proceso</h4>
          <canvas id="chart-eff"></canvas>
        </div>

        <div class="panel">
          <h4>Calidad por Proceso</h4>
          <canvas id="chart-qual"></canvas>
        </div>

        <div class="panel large">
          <h4>Detalles por Persona</h4>
          <div id="person-details"></div>
          <div id="analysis-box" class="analysis-box" aria-live="polite"></div>
        </div>
      </div>

      <footer class="controls">
        <label>Velocidad de simulaci√≥n
          <input id="sim-speed" type="range" min="0.25" max="2" step="0.25" value="1">
        </label>
        <label>
          Aleatoriedad (impacto en calidad/tiempo)
          <input id="sim-noise" type="range" min="0" max="1" step="0.05" value="0.2">
        </label>
      </footer>
    </section>
  </main>

  <!-- Help floating button and modal -->
  <button id="help-fab" title="Ayuda">?</button>

  <div id="help-modal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button id="help-close" class="modal-close">&times;</button>
      <h2>Introducci√≥n</h2>
      <p>Esta herramienta permite simular procesos, medir eficiencia y calidad por proceso y por persona, y analizar costos y asignaciones de tareas.</p>
      <h3>Objetivo general</h3>
      <p>Facilitar la toma de decisiones mediante una simulaci√≥n gr√°fica de carga de trabajo, eficiencia y calidad por proceso.</p>
      <h3>C√≥mo llenar los datos (gu√≠a paso a paso)</h3>
      <ol>
        <li><strong>A√±adir procesos</strong>: En "A√±adir Proceso" indique un nombre claro (ej. "Recepci√≥n"), el n√∫mero de personas asignadas a ese proceso y la meta de calidad (0-100) que espera alcanzar para ese proceso. Ejemplo: 3 personas, meta calidad 92.</li>
        <li><strong>A√±adir tareas</strong>: Seleccione el proceso correspondiente, ingrese el nombre de la tarea (ej. "Verificar pedido"), la dificultad (1-10, donde 1 es muy simple y 10 muy complejo), el costo unitario estimado por tarea y la cantidad total de tareas a procesar. La dificultad afecta tiempo y calidad estimada.</li>
        <li><strong>Revisar asignaciones autom√°ticas</strong>: Si no asigna tareas manualmente, la aplicaci√≥n reparte las tareas de forma equitativa entre las personas del proceso al ejecutar la simulaci√≥n.</li>
        <li><strong>Ajustar asignaci√≥n por persona</strong>: En "Ajustar asignaci√≥n por persona" seleccione el proceso y para cada tarea introduzca cu√°ntas unidades debe realizar cada persona (la suma idealmente debe coincidir con la cantidad total de la tarea). Si las sumas difieren, la simulaci√≥n escala las cantidades para cumplir la cantidad total.</li>
        <li><strong>Ejecutar simulaci√≥n</strong>: Pulse "Ejecutar Simulaci√≥n" para que el motor calcule m√©tricas por persona y por proceso: eficiencia (E) y calidad (Q), costos y detalles por persona.</li>
        <li><strong>Interpretar resultados</strong>: Revise "Detalles por Persona" y el "An√°lisis interpretativo" para recomendaciones r√°pidas; use la secci√≥n de registros para ver resumen por proceso y costos.</li>
      </ol>

      <h3>Qu√© significa cada control importante</h3>
      <ul>
        <li><strong>Velocidad de simulaci√≥n</strong>: Ajusta un factor que simula cambios en ritmo de trabajo. Valores mayores modelan procesos m√°s r√°pidos (por ejemplo, mejores herramientas o mayor ritmo), lo que puede aumentar la eficiencia estimada; valores menores representan ritmos m√°s lentos que pueden reducir eficiencia. No cambia cantidades de tareas, solo altera el tiempo/efectividad por tarea en la simulaci√≥n.</li>
        <li><strong>Aleatoriedad (impacto en calidad/tiempo)</strong>: Controla el componente de variabilidad estoc√°stica en la simulaci√≥n ‚Äî mayor aleatoriedad introduce m√°s fluctuaci√≥n en resultados de eficiencia y calidad (simulando errores, variabilidad humana, fallos aleatorios), mientras que valores bajos generan resultados m√°s deterministas y estables.</li>
      </ul>

      <h3>Ejemplo completo y c√≥mo interpretarlo</h3>
      <p>Ejemplo: Proceso "Recepci√≥n" con 3 personas y meta calidad 92.</p>
      <ul>
        <li>Tarea 1: "Verificar pedido" ‚Äî dificultad 3, costo 4.5, qty 30, asignada 10/10/10.</li>
        <li>Tarea 2: "Registrar entrada" ‚Äî dificultad 2, costo 2.0, qty 20, asignada 7/7/6.</li>
      </ul>
      <p>Al ejecutar la simulaci√≥n obtendr√°:</p>
      <ul>
        <li><strong>Tareas por proceso</strong>: total de tareas de "Recepci√≥n" (ej. 50).</li>
        <li><strong>Eficiencia por persona</strong>: E indica qu√© tan r√°pido/efectivo trabaja cada persona considerando dificultad y velocidad; un E bajo sugiere sobrecarga o tareas muy complejas.</li>
        <li><strong>Calidad por persona</strong>: Q muestra la calidad esperada seg√∫n la dificultad y la meta del proceso; valores por debajo de la meta indican necesidad de capacitaci√≥n o revisar asignaciones.</li>
        <li><strong>Costos</strong>: Se calculan por persona multiplicando tareas asignadas por costo unitario.</li>
      </ul>
      <p>Interpretaci√≥n pr√°ctica: Si la eficiencia es baja (por ejemplo <60%) y la calidad cae por debajo del objetivo, intente redistribuir tareas, reducir la dificultad (simplificar procesos) o aumentar personal; si la variabilidad (aleatoriedad) genera resultados inestables, considere estandarizar pasos o formar al personal para reducir errores.</p>

      <div style="text-align:right;margin-top:8px"><button id="help-download-example">Cargar ejemplo detallado</button></div>
    </div>
  </div>

  <!-- Tasks management modal -->
  <div id="tasks-modal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button id="tasks-close" class="modal-close">&times;</button>
      <h2>Tareas agregadas</h2>
      <div style="margin-bottom:8px" class="muted">Edite filas y presione el icono guardar (üíæ) para aplicar cambios por tarea.</div>
      <div style="overflow:auto;max-height:360px">
        <table id="tasks-table" class="tasks-table">
          <thead>
            <tr>
              <th>Proceso</th>
              <th>Nombre</th>
              <th>Dificultad</th>
              <th>Costo</th>
              <th>Cantidad</th>
              <th>Asignaciones</th>
              <th>Acci√≥n</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
        <button id="tasks-close-2">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Message / Decision modal (custom) -->
  <div id="msg-modal" class="modal" aria-hidden="true" data-purpose="">
    <div class="modal-content" id="msg-content" style="max-width:520px">
      <div id="msg-text" style="white-space:pre-wrap;margin-bottom:12px;color:#111"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;">
        <button id="msg-no" class="secondary" style="display:none;padding:8px 12px;border-radius:6px">No</button>
        <button id="msg-yes" style="padding:8px 12px;border-radius:6px">OK</button>
      </div>
    </div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>

